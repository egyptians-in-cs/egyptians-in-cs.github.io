<!-- Hero Section -->
<section class="mb-8">
  <div class="bg-gradient-to-r from-navy-900 to-navy-800 rounded-2xl p-6 md:p-8 text-white shadow-elevated">
    <h1 class="text-2xl md:text-3xl font-serif font-bold mb-4">
      Welcome to Egyptians in Computer Science
    </h1>
    <p class="text-navy-200 leading-relaxed mb-6 max-w-3xl">
      A website dedicated to showcasing the profiles of prominent Egyptian researchers in
      Computer Science and related fields. To be considered for inclusion, the only criteria
      is that the individual must have an <span class="text-gold-400 font-semibold">h-index of 5 or higher</span>.
      Submit suggestions via
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSdLaYBQyOzI5gnlGzwOki3b1TJtFjLUeHUKxkGtXQDhHdSreg/viewform"
         target="_blank"
         class="text-gold-400 hover:text-gold-300 underline">this form</a>.
    </p>

    <!-- Stats Row -->
    <div class="flex flex-wrap gap-6 mb-6">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-gold-400/20 rounded-lg flex items-center justify-center">
          <i class="fa-solid fa-users text-gold-400 text-xl"></i>
        </div>
        <div>
          <div class="text-2xl font-bold text-gold-400">{{ profiles.length }}</div>
          <div class="text-sm text-navy-300">Total Researchers</div>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-teal-400/20 rounded-lg flex items-center justify-center">
          <i class="fa-solid fa-filter text-teal-400 text-xl"></i>
        </div>
        <div>
          <div class="text-2xl font-bold text-teal-400">{{ researchers.length }}</div>
          <div class="text-sm text-navy-300">Showing</div>
        </div>
      </div>
    </div>

    <!-- Action Links -->
    <div class="flex flex-wrap gap-4 pt-6 border-t border-navy-700">
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSdLaYBQyOzI5gnlGzwOki3b1TJtFjLUeHUKxkGtXQDhHdSreg/viewform"
         target="_blank"
         class="btn-secondary">
        <i class="fa fa-pen mr-2"></i>
        Nominate Someone
      </a>
      <a href="https://medium.com/@bkhmsi/egyptians-in-ai-research-1ff64c78cc5b"
         target="_blank"
         class="inline-flex items-center px-5 py-2.5 border-2 border-white/30 text-white font-medium rounded-lg hover:bg-white/10 transition-all duration-200">
        <i class="fa-brands fa-medium mr-2"></i>
        Read the Story
      </a>
    </div>
  </div>
</section>

<!-- Two Column Layout -->
<div class="lg:grid lg:grid-cols-12 lg:gap-8">

  <!-- Sidebar -->
  <aside class="lg:col-span-3 mb-8 lg:mb-0">
    <div class="lg:sticky lg:top-24 space-y-4">

      <!-- Search Box -->
      <div class="bg-white rounded-xl shadow-card p-4">
        <label class="block text-sm font-semibold text-navy-900 mb-2">
          <i class="fa fa-search text-navy-500 mr-2"></i>
          Search Researchers
        </label>
        <div class="relative">
          <input
            type="text"
            (keyup)="filterProfiles($event)"
            placeholder="Search by name..."
            class="input-field pr-10"
          >
          <i class="fa fa-search absolute right-4 top-1/2 -translate-y-1/2 text-navy-400"></i>
        </div>
      </div>

      <!-- Sort Buttons -->
      <div class="bg-white rounded-xl shadow-card p-4">
        <h3 class="text-sm font-semibold text-navy-900 mb-3">
          <i class="fa fa-sort text-navy-500 mr-2"></i>
          Sort By
        </h3>
        <div class="grid grid-cols-2 gap-2">
          <button
            (click)="sortAZ()"
            class="flex items-center justify-center gap-2 px-3 py-2
                   bg-navy-50 hover:bg-navy-100 text-navy-700
                   rounded-lg text-sm font-medium transition-colors">
            <i class="fas fa-sort-alpha-down"></i>
            A-Z
          </button>
          <button
            (click)="sortHIndex()"
            class="flex items-center justify-center gap-2 px-3 py-2
                   bg-emerald-50 hover:bg-emerald-100 text-emerald-700
                   rounded-lg text-sm font-medium transition-colors">
            <i class="fa-solid fa-arrow-down-9-1"></i>
            h-Index
          </button>
          <button
            (click)="sortCitations()"
            class="flex items-center justify-center gap-2 px-3 py-2
                   bg-amber-50 hover:bg-amber-100 text-amber-700
                   rounded-lg text-sm font-medium transition-colors">
            <i class="fa-solid fa-arrow-down-9-1"></i>
            Citations
          </button>
          <button
            (click)="sortShuffle()"
            class="flex items-center justify-center gap-2 px-3 py-2
                   bg-rose-50 hover:bg-rose-100 text-rose-700
                   rounded-lg text-sm font-medium transition-colors">
            <i class="fas fa-shuffle"></i>
            Shuffle
          </button>
        </div>
      </div>

      <!-- Active Filter Badge -->
      <div *ngIf="selectedMainTrack !== 'all'"
           class="bg-navy-900 text-white rounded-xl p-4 shadow-card">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-xs text-navy-300 mb-1">Active Filter</div>
            <div class="font-medium text-sm">
              {{ selectedMainTrack }}
              <span *ngIf="selectedSubtrack" class="text-navy-300"> / {{ selectedSubtrack }}</span>
              <span *ngIf="selectedArea" class="text-navy-300"> / {{ selectedArea }}</span>
            </div>
          </div>
          <button
            (click)="clearFilters()"
            class="p-2 hover:bg-navy-800 rounded-lg transition-colors"
            title="Clear filter">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <!-- Tree Filter -->
      <div class="bg-white rounded-xl shadow-card overflow-hidden">
        <div class="px-4 py-3 bg-navy-50 border-b border-navy-100
                    flex items-center justify-between">
          <h3 class="font-semibold text-navy-900 text-sm">
            <i class="fas fa-sitemap text-navy-500 mr-2"></i>
            Research Areas
          </h3>
          <div class="flex gap-1">
            <button
              (click)="expandAllTracks()"
              class="p-1.5 text-navy-500 hover:bg-navy-100 rounded transition-colors"
              title="Expand All">
              <i class="fas fa-expand text-xs"></i>
            </button>
            <button
              (click)="collapseAllTracks()"
              class="p-1.5 text-navy-500 hover:bg-navy-100 rounded transition-colors"
              title="Collapse All">
              <i class="fas fa-compress text-xs"></i>
            </button>
          </div>
        </div>

        <div class="p-3 max-h-[50vh] overflow-y-auto scrollbar-academic">
          <!-- All Researchers Option -->
          <div
            (click)="filterByMainTrack('all')"
            class="tree-item mb-2"
            [class.active]="selectedMainTrack === 'all'">
            <i class="fas fa-globe-americas text-teal-500"></i>
            <span class="flex-1 font-medium text-sm">All Research Areas</span>
            <span class="badge badge-primary">{{ profiles.length }}</span>
          </div>

          <!-- Main Tracks -->
          <div *ngFor="let track of getMainTracks()" class="mb-1">
            <!-- Track Header -->
            <div class="tree-item py-1.5"
                 [class.active]="isTrackActive(track)">
              <button
                (click)="toggleTrack(track); $event.stopPropagation()"
                class="w-5 text-navy-400 hover:text-navy-600">
                <i class="fas text-xs"
                   [ngClass]="isTrackExpanded(track) ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
              </button>
              <span class="flex-1 flex items-center gap-2" (click)="filterByMainTrack(track)">
                <i class="fas text-sm"
                   [ngClass]="isTrackExpanded(track) ? 'fa-folder-open text-gold-500' : 'fa-folder text-gold-400'"></i>
                <span class="font-medium text-sm truncate">{{ track }}</span>
              </span>
              <span *ngIf="getCount(track) > 0" class="badge badge-primary text-xs">
                {{ getCount(track) }}
              </span>
            </div>

            <!-- Subtracks -->
            <div *ngIf="isTrackExpanded(track)"
                 class="ml-5 pl-3 border-l-2 border-dashed border-navy-200 animate-slide-down">
              <div *ngFor="let subtrack of getSubtracks(track)" class="mb-0.5">
                <div class="tree-item py-1"
                     [class.active]="isSubtrackActive(track, subtrack)">
                  <button
                    (click)="toggleSubtrack(track, subtrack); $event.stopPropagation()"
                    class="w-4 text-navy-400 hover:text-navy-600">
                    <i class="fas text-xs"
                       [ngClass]="isSubtrackExpanded(track, subtrack) ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
                  </button>
                  <span class="flex-1 flex items-center gap-2"
                        (click)="filterBySubtrack(track, subtrack)">
                    <i class="fas fa-layer-group text-teal-500 text-xs"></i>
                    <span class="text-sm truncate">{{ subtrack }}</span>
                  </span>
                  <span *ngIf="getCount(subtrack) > 0" class="badge badge-teal text-xs">
                    {{ getCount(subtrack) }}
                  </span>
                </div>

                <!-- Areas (Level 3) -->
                <div *ngIf="isSubtrackExpanded(track, subtrack)"
                     class="ml-4 pl-2 border-l border-dashed border-navy-100 animate-slide-down">
                  <div *ngFor="let area of getAreas(track, subtrack)"
                       (click)="getCount(area) > 0 ? filterByArea(area) : null"
                       class="flex items-center gap-2 px-2 py-1 rounded text-xs
                              transition-colors"
                       [class]="isAreaActive(area)
                                ? 'bg-navy-900 text-white cursor-pointer'
                                : getCount(area) > 0
                                  ? 'text-navy-700 hover:bg-navy-50 cursor-pointer'
                                  : 'text-navy-300 cursor-default'">
                    <i class="fas fa-tag"></i>
                    <span class="flex-1 truncate">{{ area }}</span>
                    <span *ngIf="getCount(area) > 0"
                          class="px-1.5 py-0.5 rounded text-xs"
                          [class]="isAreaActive(area) ? 'bg-white/20' : 'bg-navy-100'">
                      {{ getCount(area) }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main Content Area -->
  <div class="lg:col-span-9">

    <!-- World Map Section -->
    <section class="mb-6">
      <h2 class="section-title mb-3">
        <i class="fas fa-globe-americas text-navy-500"></i>
        Egyptians Around the World
        <span class="text-sm font-normal text-navy-500 ml-2">
          ({{ locationCount }} mapped locations)
        </span>
      </h2>
      <div class="bg-white rounded-xl shadow-card overflow-hidden">
        <app-map
          [researchers]="researchersWithLocation"
          mapId="english-map">
        </app-map>
      </div>
    </section>

    <!-- Divider -->
    <div class="border-t border-navy-200 my-6"></div>

    <!-- Researcher Cards Grid -->
    <section>
      <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6">
        <article
          *ngFor="let researcher of researchers"
          [id]="researcher.name"
          class="research-card group scroll-offset">

          <!-- Card Header with Photo -->
          <div class="relative card-header-gradient p-6 text-center">
            <!-- Edit Button -->
            <button
              (click)="editProfile(researcher)"
              class="absolute top-3 right-3 p-2 text-navy-400 hover:text-white
                     opacity-0 group-hover:opacity-100 transition-opacity"
              title="Edit Profile">
              <i class="fa-solid fa-pencil"></i>
            </button>

            <!-- Profile Photo -->
            <img
              [src]="researcher.photo"
              [alt]="researcher.name"
              class="w-24 h-24 rounded-full mx-auto border-4 border-gold-400
                     shadow-lg object-cover"
            >

            <!-- Name -->
            <h3 class="mt-3 text-lg font-serif font-bold text-white">
              {{ researcher.name }}
            </h3>

            <!-- Position -->
            <p class="text-sm text-navy-300 mt-1">
              {{ researcher.position }}
            </p>
          </div>

          <!-- Card Body -->
          <div class="p-4">
            <!-- Affiliation -->
            <div class="flex items-start gap-2 mb-3">
              <i class="fas fa-university text-navy-400 mt-0.5 text-sm"></i>
              <span class="text-sm text-navy-600 line-clamp-2">{{ researcher.affiliation }}</span>
            </div>

            <!-- Metrics -->
            <div *ngIf="researcher.hindex > 0"
                 class="flex gap-4 mb-3 p-3 bg-navy-50 rounded-lg">
              <div class="text-center flex-1">
                <div class="text-lg font-bold text-navy-900">{{ researcher.hindex }}</div>
                <div class="text-xs text-navy-500">h-index</div>
              </div>
              <div class="w-px bg-navy-200"></div>
              <div class="text-center flex-1">
                <div class="text-lg font-bold text-navy-900">{{ researcher.citedby | number }}</div>
                <div class="text-xs text-navy-500">Citations</div>
              </div>
            </div>
            <div *ngIf="researcher.hindex === 0" class="mb-3 text-sm text-navy-400 italic">
              Metrics not available
            </div>

            <!-- Research Interests -->
            <div class="mb-3">
              <h4 class="text-xs font-semibold text-navy-500 uppercase tracking-wide mb-2">
                Research Interests
              </h4>
              <div class="flex flex-wrap gap-1 max-h-20 overflow-y-auto scrollbar-hide">
                <span
                  *ngFor="let interest of researcher.standardized_interests"
                  class="inline-block px-2 py-0.5 bg-teal-500/10 text-teal-700
                         rounded text-xs">
                  {{ interest }}
                </span>
              </div>
            </div>

            <!-- Social Links -->
            <div class="flex items-center justify-center gap-2 pt-3 border-t border-navy-100">
              <a *ngIf="researcher.website"
                 [href]="researcher.website"
                 target="_blank"
                 class="social-link"
                 title="Website">
                <i class="fas fa-globe"></i>
              </a>
              <a *ngIf="researcher.scholar"
                 [href]="researcher.scholar"
                 target="_blank"
                 class="social-link"
                 title="Google Scholar">
                <i class="fas fa-graduation-cap"></i>
              </a>
              <a *ngIf="researcher.twitter"
                 [href]="researcher.twitter"
                 target="_blank"
                 class="social-link hover:bg-sky-500"
                 title="Twitter/X">
                <i class="fab fa-twitter"></i>
              </a>
              <a *ngIf="researcher.linkedin"
                 [href]="researcher.linkedin"
                 target="_blank"
                 class="social-link hover:bg-blue-600"
                 title="LinkedIn">
                <i class="fab fa-linkedin-in"></i>
              </a>
            </div>
          </div>
        </article>
      </div>
    </section>

  </div>
</div>
